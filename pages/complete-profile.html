<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Profile - Rep-Link</title>
    <meta name="description" content="Complete your Rep-Link profile and optionally connect Singpass for faster verification.">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/layout.css">
    <link rel="stylesheet" href="../styles/components.css">
    <link rel="stylesheet" href="../styles/utilities.css">
    <link rel="stylesheet" href="../styles/animations.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../assets/icons/favicon.svg">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header__content">
                <div class="header__logo">
                    <a href="../index.html" aria-label="Rep-Link Home">
                        <svg class="logo" width="120" height="32" viewBox="0 0 120 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="0" y="8" width="24" height="16" rx="2" fill="var(--color-primary)"/>
                            <path d="M8 12h8v8H8z" fill="var(--surface-0)"/>
                            <text x="32" y="20" font-family="system-ui" font-size="16" font-weight="700" fill="var(--brand-navy-900)">Rep-Link</text>
                        </svg>
                    </a>
                </div>
                
                <nav class="header__nav" role="navigation" aria-label="Main navigation">
                    <div class="header__ctas">
                        <a href="opportunities.html" class="btn btn--secondary">Browse Opportunities</a>
                        <a href="login.html" class="btn btn--tertiary">Log in</a>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" role="main">
        <div class="page">
            <div class="page__header">
                <div class="container">
                    <h1 class="page__title">Complete Your Profile</h1>
                    <p class="page__subtitle">Optionally connect Singpass to pre-fill your details and speed up verification.</p>
                </div>
            </div>
            
            <div class="page__main">
                <div class="container">
                    <div class="profile-completion-container">
                        <!-- Singpass Connection Section -->
                        <section class="card">
                            <div class="card-header">
                                <h2>Connect Singpass (Mock)</h2>
                                <p class="text-muted">This prototype simulates MyInfo retrieval for form filling only.</p>
                            </div>
                            
                            <div class="card-content">
                                <div class="singpass-connection">
                                    <div class="singpass-info">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M9 12l2 2 4-4"></path>
                                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                                        </svg>
                                        <div>
                                            <h3>Secure Identity Verification</h3>
                                            <p>Connect your Singpass account to automatically fill in your personal details and speed up the verification process.</p>
                                        </div>
                                    </div>
                                    
                                    <button id="btnSingpass" class="btn btn--primary">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M9 12l2 2 4-4"></path>
                                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                                        </svg>
                                        Connect Singpass
                                    </button>
                                </div>
                                
                                <div id="singpassSummary" class="singpass-summary visually-hidden">
                                    <!-- Singpass connection summary will appear here -->
                                </div>
                            </div>
                        </section>
                        
                        <!-- Profile Form Section -->
                        <section class="card">
                            <div class="card-header">
                                <h2>Your Details</h2>
                                <p class="text-muted">Complete your profile information. Fields will be pre-filled if you connect Singpass.</p>
                            </div>
                            
                            <div class="card-content">
                                <form id="profileForm" class="profile-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="firstName" class="form-label">First Name *</label>
                                            <input 
                                                type="text" 
                                                id="firstName" 
                                                name="firstName" 
                                                class="form-input" 
                                                required
                                            >
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="lastName" class="form-label">Last Name *</label>
                                            <input 
                                                type="text" 
                                                id="lastName" 
                                                name="lastName" 
                                                class="form-input" 
                                                required
                                            >
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="email" class="form-label">Email Address *</label>
                                        <input 
                                            type="email" 
                                            id="email" 
                                            name="email" 
                                            class="form-input" 
                                            required
                                        >
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="phone" class="form-label">Phone Number *</label>
                                        <input 
                                            type="tel" 
                                            id="phone" 
                                            name="phone" 
                                            class="form-input" 
                                            placeholder="+65 9123 4567"
                                            required
                                        >
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="nric" class="form-label">NRIC (Masked) *</label>
                                        <input 
                                            type="text" 
                                            id="nric" 
                                            name="nric" 
                                            class="form-input" 
                                            placeholder="S1234567A"
                                            required
                                        >
                                        <div class="form-help">Your NRIC will be masked for privacy (e.g., S1234567A)</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="address" class="form-label">Address</label>
                                        <textarea 
                                            id="address" 
                                            name="address" 
                                            class="form-textarea" 
                                            rows="3"
                                            placeholder="Enter your residential address"
                                        ></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="role" class="form-label">Account Type *</label>
                                        <select id="role" name="role" class="form-select" required>
                                            <option value="">Select your role</option>
                                            <option value="rep">Sales Representative</option>
                                            <option value="business">Business Client</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="bio" class="form-label">Bio / Professional Summary</label>
                                        <textarea 
                                            id="bio" 
                                            name="bio" 
                                            class="form-textarea" 
                                            rows="4"
                                            placeholder="Tell us about your professional background and experience..."
                                        ></textarea>
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn--primary">
                                            Complete Profile
                                        </button>
                                        <a href="opportunities.html" class="btn btn--tertiary">
                                            Skip for Now
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer__content">
                <div class="footer__section">
                    <h3 class="footer__title">Contact</h3>
                    <div class="footer__contact">
                        <p>📱 +65 9123 4567</p>
                        <p>✉️ hello@rep-link.sg</p>
                        <p>📷 @replinksg</p>
                    </div>
                </div>
                
                <div class="footer__section">
                    <h3 class="footer__title">Support</h3>
                    <nav class="footer__nav">
                        <a href="faq.html">FAQ</a>
                        <a href="help.html">Help Center</a>
                        <a href="privacy.html">Privacy Policy</a>
                        <a href="terms.html">Terms of Service</a>
                    </nav>
                </div>
                
                <div class="footer__section">
                    <h3 class="footer__title">About</h3>
                    <p class="footer__description">
                        Rep-Link connects freelance sales representatives with businesses in Singapore, 
                        providing secure, milestone-based commission opportunities.
                    </p>
                </div>
            </div>
            
            <div class="footer__bottom">
                <p>&copy; 2024 Rep-Link. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Scripts -->
    <script type="module" src="../scripts/app.js"></script>
    <script type="module">
        import { API } from '../scripts/data/api.js';
        import { store } from '../scripts/data/store.js';
        import { Toast } from '../scripts/ui/components.js';
        
        class CompleteProfilePage {
            constructor() {
                this.toast = new Toast();
                this.init();
            }
            
            init() {
                this.setupSingpassConnection();
                this.setupProfileForm();
                this.loadExistingData();
            }
            
            setupSingpassConnection() {
                const btn = document.getElementById('btnSingpass');
                if (btn) {
                    btn.addEventListener('click', async () => {
                        await this.connectSingpass();
                    });
                }
            }
            
            async connectSingpass() {
                const btn = document.getElementById('btnSingpass');
                const summary = document.getElementById('singpassSummary');
                
                try {
                    btn.disabled = true;
                    btn.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12,6 12,12 16,14"></polyline>
                        </svg>
                        Connecting...
                    `;
                    
                    // Simulate API call
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // Mock Singpass data
                    const singpassData = {
                        name: 'John Doe',
                        nric_masked: 'S1234567A',
                        dob: '1990-01-15',
                        email: 'john.doe@email.com',
                        mobile: '+65 9123 4567',
                        address: '123 Main Street, Singapore 123456'
                    };
                    
                    // Update form fields
                    this.fillFormWithSingpassData(singpassData);
                    
                    // Show success summary
                    summary.classList.remove('visually-hidden');
                    summary.innerHTML = `
                        <div class="alert alert--success">
                            <div class="alert-content">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 12l2 2 4-4"></path>
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                <div>
                                    <strong>Singpass Connected Successfully!</strong>
                                    <p>Your details have been pre-filled from MyInfo. Please review and complete any missing information.</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Update button state
                    btn.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                        Connected
                    `;
                    btn.classList.remove('btn--primary');
                    btn.classList.add('btn--success');
                    
                    this.toast.show('Singpass connected successfully!', 'success');
                    
                } catch (error) {
                    console.error('Failed to connect Singpass:', error);
                    this.toast.show('Failed to connect Singpass. Please try again.', 'error');
                    
                    btn.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12l2 2 4-4"></path>
                            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                            <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                            <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                        </svg>
                        Connect Singpass
                    `;
                    btn.disabled = false;
                }
            }
            
            fillFormWithSingpassData(data) {
                // Split name into first and last
                const nameParts = data.name.split(' ');
                document.getElementById('firstName').value = nameParts[0] || '';
                document.getElementById('lastName').value = nameParts.slice(1).join(' ') || '';
                
                document.getElementById('email').value = data.email || '';
                document.getElementById('phone').value = data.mobile || '';
                document.getElementById('nric').value = data.nric_masked || '';
                document.getElementById('address').value = data.address || '';
            }
            
            setupProfileForm() {
                const form = document.getElementById('profileForm');
                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.submitProfile();
                    });
                }
            }
            
            async submitProfile() {
                try {
                    const formData = new FormData(document.getElementById('profileForm'));
                    const profileData = {
                        firstName: formData.get('firstName'),
                        lastName: formData.get('lastName'),
                        email: formData.get('email'),
                        phone: formData.get('phone'),
                        nric: formData.get('nric'),
                        address: formData.get('address'),
                        role: formData.get('role'),
                        bio: formData.get('bio'),
                        completedAt: new Date().toISOString()
                    };
                    
                    // Update user in store
                    const auth = store.get('auth');
                    if (auth && auth.user) {
                        const updatedUser = { ...auth.user, ...profileData };
                        store.set('auth', { ...auth, user: updatedUser });
                    }
                    
                    this.toast.show('Profile completed successfully!', 'success');
                    
                    // Redirect based on role
                    setTimeout(() => {
                        if (profileData.role === 'business') {
                            window.location.href = 'business-dashboard.html';
                        } else {
                            window.location.href = 'rep-dashboard.html';
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('Failed to submit profile:', error);
                    this.toast.show('Failed to complete profile. Please try again.', 'error');
                }
            }
            
            loadExistingData() {
                // Load any existing user data
                const auth = store.get('auth');
                if (auth && auth.user) {
                    const user = auth.user;
                    if (user.firstName) document.getElementById('firstName').value = user.firstName;
                    if (user.lastName) document.getElementById('lastName').value = user.lastName;
                    if (user.email) document.getElementById('email').value = user.email;
                    if (user.phone) document.getElementById('phone').value = user.phone;
                    if (user.nric) document.getElementById('nric').value = user.nric;
                    if (user.address) document.getElementById('address').value = user.address;
                    if (user.role) document.getElementById('role').value = user.role;
                    if (user.bio) document.getElementById('bio').value = user.bio;
                }
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new CompleteProfilePage();
        });
    </script>
</body>
</html>
